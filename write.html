<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Write · Typewriter Tales</title>
  "/>
  <style>
    .write-page{max-width:780px;margin:0 auto;padding:56px 24px 100px}
    .write-header{text-align:center;margin-bottom:40px}
    .write-header h1{font-family:'Special Elite',serif;font-size:2rem;margin-bottom:8px}
    .write-header p{font-size:.82rem;color:#999;letter-spacing:.04em}
    .gate{background:#fdfaf3;border:1px solid #e0d9ce;padding:40px;text-align:center;max-width:380px;margin:80px auto}
    .gate h2{font-family:'Special Elite',serif;font-size:1.3rem;margin-bottom:20px;color:#2c2c2c}
    .gate input{font-family:'Courier Prime',monospace;font-size:.9rem;padding:10px 16px;border:1px solid #d4cdc0;background:#f5f0e8;color:#2c2c2c;width:100%;outline:none;margin-bottom:16px;text-align:center;letter-spacing:.1em}
    .gate input:focus{border-color:#aaa}
    .gate-error{font-size:.75rem;color:#b22222;margin-top:8px;display:none}
    .editor{display:none}
    .meta-bar{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
    .meta-bar input,.desc-input{font-family:'Courier Prime',monospace;font-size:.85rem;padding:8px 14px;border:1px solid #d4cdc0;background:#fdfaf3;color:#2c2c2c;outline:none;width:100%}
    .meta-bar input:focus,.desc-input:focus{border-color:#aaa}
    .desc-bar{margin-bottom:20px}
    .paper{background:#fdfaf3;border:1px solid #e0d9ce;box-shadow:3px 3px 0 #e0d9ce;padding:48px 56px 48px 80px;min-height:480px;position:relative;cursor:text;background-image:linear-gradient(#fdfaf3 0px,#fdfaf3 27px,#e0d9ce 27px,#e0d9ce 28px);background-size:100% 28px}
    .paper::before{content:'';position:absolute;top:0;bottom:0;left:56px;width:1px;background:#f0b0a8;opacity:.7}
    #typed-display{font-family:'Courier Prime',monospace;font-size:1rem;line-height:28px;white-space:pre-wrap;word-break:break-word;color:#2c2c2c;min-height:28px;position:relative;z-index:1}
    .tw-cursor-live{display:inline-block;width:9px;height:1em;background:#2c2c2c;vertical-align:text-bottom;margin-left:1px;animation:blink .75s step-end infinite}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
    @keyframes clack{0%{transform:translateX(0)}30%{transform:translateX(-1px)}70%{transform:translateX(1px)}100%{transform:translateX(0)}}
    .clack{animation:clack .07s ease}
    .paper-hint{text-align:center;margin-top:12px;font-size:.72rem;color:#ccc;letter-spacing:.06em}
    .char-count{text-align:center;margin-top:8px;font-size:.72rem;color:#ccc}
    .action-bar{display:flex;align-items:center;justify-content:center;gap:14px;margin-top:28px;flex-wrap:wrap}
    .toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);background:#2c2c2c;color:#fdfaf3;font-family:'Courier Prime',monospace;font-size:.82rem;padding:12px 28px;opacity:0;transition:opacity .3s,transform .3s;pointer-events:none;z-index:300}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    #ghost{position:fixed;opacity:0;pointer-events:none;top:-9999px;left:-9999px}
  </style>
</head>
<body>

<nav>
  <a href="index.html" class="nav-logo">Typewriter Tales</a>
  <ul class="nav-links">
    ><a href="index.html">home</a></li>
    ><a href="blogs.html">blogs</a></li>
    ><a href="typewriter.html">experience</a></li>
  </ul>
</nav>

<div class="page-wrapper">
  <div class="write-page">

    <!-- Password Gate -->
    <div class="gate" id="gate">
      <h2>admin access</h2>
      <input type="password" id="gate-input" placeholder="enter password" autocomplete="off"/>
      <button class="btn btn-fill" id="gate-btn">enter</button>
      <p class="gate-error" id="gate-error">incorrect password.</p>
    </div>

    <!-- Editor (hidden until password correct) -->
    <div class="editor" id="editor">
      <div class="write-header">
        <h1>Write a Post</h1>
        <p>type your post below · it will be published to the blog</p>
      </div>

      <div class="meta-bar">
        <input type="text" id="post-title" placeholder="post title" maxlength="100"/>
        <input type="text" id="post-date" placeholder="e.g. 27 February 2026" maxlength="40"/>
      </div>

      <div class="desc-bar">
        <input type="text" id="post-desc" class="desc-input" placeholder="short description (shown in blog list)" maxlength="160"/>
      </div>

      <div class="paper" id="paper">
        <div id="typed-display"><span class="tw-cursor-live" id="tw-cursor"></span></div>
      </div>
      <p class="paper-hint">click the paper · start typing · enter for new line</p>
      <p class="char-count"><span id="char-count">0</span> / 5000 characters</p>

      <div class="action-bar">
        <button class="btn" id="clear-btn">clear</button>
        <button class="btn btn-fill" id="publish-btn">publish post</button>
      </div>
    </div>

  </div>
</div>

<footer>© 2026 · Typewriter Tales · made with patience and coffee</footer>

<div class="toast" id="toast"></div>
<textarea id="ghost"></textarea>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBPnZ8f4cek3JcIwfopsmxnCAGTXoH--yc",
  authDomain: "typewritertales-5bdda.firebaseapp.com",
  projectId: "typewritertales-5bdda",
  storageBucket: "typewritertales-5bdda.firebasestorage.app",
  messagingSenderId: "631041179526",
  appId: "1:631041179526:web:7d2fea0e3a5b48ce567607"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ── Password Gate ──
const ADMIN_PASSWORD = "typewriter"; // change this to whatever you want
const gate      = document.getElementById("gate");
const gateInput = document.getElementById("gate-input");
const gateBtn   = document.getElementById("gate-btn");
const gateError = document.getElementById("gate-error");
const editor    = document.getElementById("editor");

function unlock() {
  if (gateInput.value === ADMIN_PASSWORD) {
    gate.style.display = "none";
    editor.style.display = "block";
    ghost.focus();
    render();
  } else {
    gateError.style.display = "block";
    gateInput.value = "";
    gateInput.focus();
  }
}

gateBtn.addEventListener("click", unlock);
gateInput.addEventListener("keydown", e => { if (e.key === "Enter") unlock(); });

// ── Typewriter Editor ──
let text = "";
const MAX = 5000;

const display    = document.getElementById("typed-display");
const cursor     = document.getElementById("tw-cursor");
const ghost      = document.getElementById("ghost");
const paper      = document.getElementById("paper");
const charCount  = document.getElementById("char-count");
const clearBtn   = document.getElementById("clear-btn");
const publishBtn = document.getElementById("publish-btn");
const toast      = document.getElementById("toast");
const titleEl    = document.getElementById("post-title");
const dateEl     = document.getElementById("post-date");
const descEl     = document.getElementById("post-desc");

function showToast(msg, dur = 3000) {
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), dur);
}

function render() {
  while (display.firstChild !== cursor) display.removeChild(display.firstChild);
  if (text.length > 0) cursor.insertAdjacentText("beforebegin", text);
  charCount.textContent = text.length;
}

function shake() {
  display.classList.remove("clack");
  void display.offsetWidth;
  display.classList.add("clack");
}

paper.addEventListener("click", () => ghost.focus());
ghost.addEventListener("blur", () => setTimeout(() => ghost.focus(), 50));

ghost.addEventListener("keydown", e => {
  if (e.key === "Backspace") {
    e.preventDefault();
    if (text.length > 0) { text = text.slice(0, -1); shake(); render(); }
    return;
  }
  if (e.key === "Enter") {
    e.preventDefault();
    if (text.length < MAX) { text += "\n"; shake(); render(); }
    return;
  }
  if (e.key.length === 1 && text.length < MAX) {
    text += e.key;
    shake();
    render();
  }
});

clearBtn.addEventListener("click", e => {
  e.stopPropagation();
  if (!text) return;
  if (confirm("Clear the page?")) { text = ""; render(); }
  ghost.focus();
});

publishBtn.addEventListener("click", async e => {
  e.stopPropagation();
  const trimmed = text.trim();
  const title   = titleEl.value.trim();
  if (!title)   { showToast("add a title first."); return; }
  if (!trimmed) { showToast("write something first."); return; }

  publishBtn.textContent = "publishing...";
  publishBtn.disabled = true;

  try {
    await addDoc(collection(db, "blogposts"), {
      title:       title,
      description: descEl.value.trim(),
      body:        trimmed,
      createdAt:   serverTimestamp()
    });
    showToast("post published to the blog!");
    text = "";
    render();
    titleEl.value = "";
    dateEl.value  = "";
    descEl.value  = "";
  } catch(err) {
    showToast("something went wrong. try again.");
    console.error(err);
  }

  publishBtn.textContent = "publish post";
  publishBtn.disabled = false;
  ghost.focus();
});
</script>

</body>
</html>

